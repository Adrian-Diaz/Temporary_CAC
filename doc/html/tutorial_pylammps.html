

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>PyLammps Tutorial &mdash; LAMMPS documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="LAMMPS documentation" href="index.html"/>
        <link rel="up" title="Tutorials" href="tutorials.html"/>
        <link rel="next" title="Using LAMMPS with Bash on Windows" href="tutorial_bash_on_windows.html"/>
        <link rel="prev" title="LAMMPS GitHub tutorial" href="tutorial_github.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="Manual.html" class="icon icon-home"> LAMMPS
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <p class="caption"><span class="caption-text">User Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Section_intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_start.html">2. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_commands.html">3. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_packages.html">4. Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_accelerate.html">5. Accelerating LAMMPS performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_howto.html">6. How-to discussions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_example.html">7. Example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_perf.html">8. Performance &amp; scalability</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_tools.html">9. Additional tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_modify.html">10. Modifying &amp; extending LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_python.html">11. Python interface to LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_errors.html">12. Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_history.html">13. Future and history</a></li>
</ul>
<p class="caption"><span class="caption-text">Index</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial_drude.html">Tutorial for Thermalized Drude oscillators in LAMMPS</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_github.html">LAMMPS GitHub tutorial</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">PyLammps Tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#comparison-of-lammps-and-pylammps-interfaces">Comparison of lammps and PyLammps interfaces</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#quick-start">Quick Start</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#system-wide-installation">System-wide Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installation-inside-of-a-virtualenv">Installation inside of a virtualenv</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-new-instance-of-pylammps">Creating a new instance of PyLammps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#commands">Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#system-state">System state</a></li>
<li class="toctree-l3"><a class="reference internal" href="#working-with-lammps-variables">Working with LAMMPS variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#retrieving-the-value-of-an-arbitrary-lammps-expressions">Retrieving the value of an arbitrary LAMMPS expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#accessing-atom-data">Accessing atom data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#evaluating-thermo-data">Evaluating thermo data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#error-handling-with-pylammps">Error handling with PyLammps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-pylammps-in-ipython-notebooks-and-jupyter">Using PyLammps in IPython notebooks and Jupyter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ipylammps-examples">IPyLammps Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#validating-a-dihedral-potential">Validating a dihedral potential</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-a-monte-carlo-relaxation">Running a Monte Carlo relaxation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-pylammps-and-mpi4py-experimental">Using PyLammps and mpi4py (Experimental)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#feedback-and-contributing">Feedback and Contributing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_bash_on_windows.html">Using LAMMPS with Bash on Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="body.html">Body particles</a></li>
<li class="toctree-l2"><a class="reference internal" href="manifolds.html">Manifolds (surfaces)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="fixes.html">Fixes</a></li>
<li class="toctree-l1"><a class="reference internal" href="computes.html">Computes</a></li>
<li class="toctree-l1"><a class="reference internal" href="pairs.html">Pair Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="bonds.html">Bond Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="angles.html">Angle Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="dihedrals.html">Dihedral Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="impropers.html">Improper Styles</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="Manual.html">LAMMPS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <div style="text-align: center; margin-bottom: -1.5em; display: block"><b>LAMMPS</b> 16 Mar 2018</div>
  <ul class="wy-breadcrumbs">
    <li><a href="Manual.html">Docs</a> &raquo;</li>
      
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
      
    <li>PyLammps Tutorial</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="http://lammps.sandia.gov">Website</a>
            <a href="Section_commands.html#comm">Commands</a>
        
      </li>
  </ul>
  <hr/>
  
    <div class="rst-footer-buttons" style="margin-bottom: 1em" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial_bash_on_windows.html" class="btn btn-neutral float-right" title="Using LAMMPS with Bash on Windows" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial_github.html" class="btn btn-neutral" title="LAMMPS GitHub tutorial" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pylammps-tutorial">
<h1><a class="toc-backref" href="#id1">PyLammps Tutorial</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#pylammps-tutorial" id="id1">PyLammps Tutorial</a><ul>
<li><a class="reference internal" href="#overview" id="id2">Overview</a><ul>
<li><a class="reference internal" href="#comparison-of-lammps-and-pylammps-interfaces" id="id3">Comparison of lammps and PyLammps interfaces</a><ul>
<li><a class="reference internal" href="#lammps-lammps" id="id4">lammps.lammps</a></li>
<li><a class="reference internal" href="#lammps-pylammps" id="id5">lammps.PyLammps</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#quick-start" id="id6">Quick Start</a><ul>
<li><a class="reference internal" href="#system-wide-installation" id="id7">System-wide Installation</a><ul>
<li><a class="reference internal" href="#step-1-building-lammps-as-a-shared-library" id="id8">Step 1: Building LAMMPS as a shared library</a></li>
<li><a class="reference internal" href="#step-2-installing-the-lammps-python-package" id="id9">Step 2: Installing the LAMMPS Python package</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation-inside-of-a-virtualenv" id="id10">Installation inside of a virtualenv</a><ul>
<li><a class="reference internal" href="#benefits-of-using-a-virtualenv" id="id11">Benefits of using a virtualenv</a></li>
<li><a class="reference internal" href="#creating-a-virtualenv-with-lammps-installed" id="id12">Creating a virtualenv with lammps installed</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#creating-a-new-instance-of-pylammps" id="id13">Creating a new instance of PyLammps</a></li>
<li><a class="reference internal" href="#commands" id="id14">Commands</a></li>
<li><a class="reference internal" href="#system-state" id="id15">System state</a></li>
<li><a class="reference internal" href="#working-with-lammps-variables" id="id16">Working with LAMMPS variables</a></li>
<li><a class="reference internal" href="#retrieving-the-value-of-an-arbitrary-lammps-expressions" id="id17">Retrieving the value of an arbitrary LAMMPS expressions</a></li>
<li><a class="reference internal" href="#accessing-atom-data" id="id18">Accessing atom data</a></li>
<li><a class="reference internal" href="#evaluating-thermo-data" id="id19">Evaluating thermo data</a></li>
<li><a class="reference internal" href="#error-handling-with-pylammps" id="id20">Error handling with PyLammps</a></li>
<li><a class="reference internal" href="#using-pylammps-in-ipython-notebooks-and-jupyter" id="id21">Using PyLammps in IPython notebooks and Jupyter</a></li>
<li><a class="reference internal" href="#ipylammps-examples" id="id22">IPyLammps Examples</a><ul>
<li><a class="reference internal" href="#validating-a-dihedral-potential" id="id23">Validating a dihedral potential</a></li>
<li><a class="reference internal" href="#running-a-monte-carlo-relaxation" id="id24">Running a Monte Carlo relaxation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-pylammps-and-mpi4py-experimental" id="id25">Using PyLammps and mpi4py (Experimental)</a></li>
<li><a class="reference internal" href="#feedback-and-contributing" id="id26">Feedback and Contributing</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id2">Overview</a></h2>
<p>PyLammps is a Python wrapper class which can be created on its own or use an
existing lammps Python object. It creates a simpler, Python-like interface to
common LAMMPS functionality. Unlike the original flat C-types interface, it
exposes a discoverable API. It no longer requires knowledge of the underlying
C++ code implementation.  Finally, the IPyLammps wrapper builds on top of
PyLammps and adds some additional features for IPython integration into IPython
notebooks, e.g. for embedded visualization output from dump/image.</p>
<div class="section" id="comparison-of-lammps-and-pylammps-interfaces">
<h3><a class="toc-backref" href="#id3">Comparison of lammps and PyLammps interfaces</a></h3>
<div class="section" id="lammps-lammps">
<h4><a class="toc-backref" href="#id4">lammps.lammps</a></h4>
<ul class="simple">
<li>uses C-Types</li>
<li>direct memory access to native C++ data</li>
<li>provides functions to send and receive data to LAMMPS</li>
<li>requires knowledge of how LAMMPS internally works (C pointers, etc)</li>
</ul>
</div>
<div class="section" id="lammps-pylammps">
<h4><a class="toc-backref" href="#id5">lammps.PyLammps</a></h4>
<ul class="simple">
<li>higher-level abstraction built on top of original C-Types interface</li>
<li>manipulation of Python objects</li>
<li>communication with LAMMPS is hidden from API user</li>
<li>shorter, more concise Python</li>
<li>better IPython integration, designed for quick prototyping</li>
</ul>
</div>
</div>
</div>
<div class="section" id="quick-start">
<h2><a class="toc-backref" href="#id6">Quick Start</a></h2>
<div class="section" id="system-wide-installation">
<h3><a class="toc-backref" href="#id7">System-wide Installation</a></h3>
<div class="section" id="step-1-building-lammps-as-a-shared-library">
<h4><a class="toc-backref" href="#id8">Step 1: Building LAMMPS as a shared library</a></h4>
<p>To use LAMMPS inside of Python it has to be compiled as shared library. This
library is then loaded by the Python interface. In this example we enable the
MOLECULE package and compile LAMMPS with C++ exceptions, PNG, JPEG and FFMPEG
output support enabled.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd $LAMMPS_DIR/src

# add packages if necessary
make yes-MOLECULE

# compile shared library using Makefile
make mpi mode=shlib LMP_INC=&quot;-DLAMMPS_PNG -DLAMMPS_JPEG -DLAMMPS_FFMPEG -DLAMMPS_EXCEPTIONS&quot; JPG_LIB=&quot;-lpng -ljpeg&quot;
</pre></div>
</div>
</div>
<div class="section" id="step-2-installing-the-lammps-python-package">
<h4><a class="toc-backref" href="#id9">Step 2: Installing the LAMMPS Python package</a></h4>
<p>PyLammps is part of the lammps Python package. To install it simply install
that package into your current Python installation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd $LAMMPS_DIR/python
python install.py
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Recompiling the shared library requires reinstalling the Python package</p>
</div>
</div>
</div>
<div class="section" id="installation-inside-of-a-virtualenv">
<h3><a class="toc-backref" href="#id10">Installation inside of a virtualenv</a></h3>
<p>You can use virtualenv to create a custom Python environment specifically tuned
for your workflow.</p>
<div class="section" id="benefits-of-using-a-virtualenv">
<h4><a class="toc-backref" href="#id11">Benefits of using a virtualenv</a></h4>
<ul class="simple">
<li>isolation of your system Python installation from your development installation</li>
<li>installation can happen in your user directory without root access (useful for HPC clusters)</li>
<li>installing packages through pip allows you to get newer versions of packages than e.g., through apt-get or yum package managers (and without root access)</li>
<li>you can even install specific old versions of a package if necessary</li>
</ul>
<p><strong>Prerequisite (e.g. on Ubuntu)</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python</span><span class="o">-</span><span class="n">virtualenv</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-virtualenv-with-lammps-installed">
<h4><a class="toc-backref" href="#id12">Creating a virtualenv with lammps installed</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># create virtualenv name &#39;testing&#39;

# activate &#39;testing&#39; environment
source testing/bin/activate

# install LAMMPS package in virtualenv
(testing) cd $LAMMPS_DIR/python
(testing) python install.py

# install other useful packages
(testing) pip install matplotlib jupyter mpi4py

...

# return to original shell
(testing) deactivate
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="creating-a-new-instance-of-pylammps">
<h2><a class="toc-backref" href="#id13">Creating a new instance of PyLammps</a></h2>
<p>To create a PyLammps object you need to first import the class from the lammps
module. By using the default constructor, a new <em>lammps</em> instance is created.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lammps</span> <span class="k">import</span> <span class="n">PyLammps</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">PyLammps</span><span class="p">()</span>
</pre></div>
</div>
<p>You can also initialize PyLammps on top of this existing <em>lammps</em> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lammps</span> <span class="k">import</span> <span class="n">lammps</span><span class="p">,</span> <span class="n">PyLammps</span>
<span class="n">lmp</span> <span class="o">=</span> <span class="n">lammps</span><span class="p">()</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">PyLammps</span><span class="p">(</span><span class="n">ptr</span><span class="o">=</span><span class="n">lmp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="commands">
<h2><a class="toc-backref" href="#id14">Commands</a></h2>
<p>Sending a LAMMPS command with the existing library interfaces is done using
the command method of the lammps object instance.</p>
<p>For instance, let’s take the following LAMMPS command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">region</span> <span class="n">box</span> <span class="n">block</span> <span class="mi">0</span> <span class="mi">10</span> <span class="mi">0</span> <span class="mi">5</span> <span class="o">-</span><span class="mf">0.5</span> <span class="mf">0.5</span>
</pre></div>
</div>
<p>In the original interface this command can be executed with the following
Python code if <em>L</em> was a lammps instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;region box block 0 10 0 5 -0.5 0.5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>With the PyLammps interface, any command can be split up into arbitrary parts
separated by whitespace, passed as individual arguments to a region method.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="s2">&quot;box block&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that each parameter is set as Python literal floating-point number. In the
PyLammps interface, each command takes an arbitrary parameter list and transparently
merges it to a single command string, separating individual parameters by whitespace.</p>
<p>The benefit of this approach is avoiding redundant command calls and easier
parameterization. In the original interface parametrization needed to be done
manually by creating formatted strings.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;region box block </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xlo</span><span class="p">,</span> <span class="n">xhi</span><span class="p">,</span> <span class="n">ylo</span><span class="p">,</span> <span class="n">yhi</span><span class="p">,</span> <span class="n">zlo</span><span class="p">,</span> <span class="n">zhi</span><span class="p">))</span>
</pre></div>
</div>
<p>In contrast, methods of PyLammps accept parameters directly and will convert
them automatically to a final command string.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">region</span><span class="p">(</span><span class="s2">&quot;box block&quot;</span><span class="p">,</span> <span class="n">xlo</span><span class="p">,</span> <span class="n">xhi</span><span class="p">,</span> <span class="n">ylo</span><span class="p">,</span> <span class="n">yhi</span><span class="p">,</span> <span class="n">zlo</span><span class="p">,</span> <span class="n">zhi</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="system-state">
<h2><a class="toc-backref" href="#id15">System state</a></h2>
<p>In addition to dispatching commands directly through the PyLammps object, it
also provides several properties which allow you to query the system state.</p>
<dl class="docutils">
<dt>L.system</dt>
<dd>Is a dictionary describing the system such as the bounding box or number of atoms</dd>
<dt>L.system.xlo, L.system.xhi</dt>
<dd>bounding box limits along x-axis</dd>
<dt>L.system.ylo, L.system.yhi</dt>
<dd>bounding box limits along y-axis</dd>
<dt>L.system.zlo, L.system.zhi</dt>
<dd>bounding box limits along z-axis</dd>
<dt>L.communication</dt>
<dd>configuration of communication subsystem, such as the number of threads or processors</dd>
<dt>L.communication.nthreads</dt>
<dd>number of threads used by each LAMMPS process</dd>
<dt>L.communication.nprocs</dt>
<dd>number of MPI processes used by LAMMPS</dd>
<dt>L.fixes</dt>
<dd>List of fixes in the current system</dd>
<dt>L.computes</dt>
<dd>List of active computes in the current system</dd>
<dt>L.dump</dt>
<dd>List of active dumps in the current system</dd>
<dt>L.groups</dt>
<dd>List of groups present in the current system</dd>
</dl>
</div>
<div class="section" id="working-with-lammps-variables">
<h2><a class="toc-backref" href="#id16">Working with LAMMPS variables</a></h2>
<p>LAMMPS variables can be both defined and accessed via the PyLammps interface.</p>
<p>To define a variable you can use the <a class="reference internal" href="variable.html"><span class="doc">variable</span></a> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">variable</span><span class="p">(</span><span class="s2">&quot;a index 2&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A dictionary of all variables is returned by L.variables</p>
<p>you can access an individual variable by retrieving a variable object from the
L.variables dictionary by name</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The variable value can then be easily read and written by accessing the value
property of this object.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
</div>
<div class="section" id="retrieving-the-value-of-an-arbitrary-lammps-expressions">
<h2><a class="toc-backref" href="#id17">Retrieving the value of an arbitrary LAMMPS expressions</a></h2>
<p>LAMMPS expressions can be immediately evaluated by using the eval method. The
passed string parameter can be any expression containing global thermo values,
variables, compute or fix data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;ke&quot;</span><span class="p">)</span> <span class="c1"># kinetic energy</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;pe&quot;</span><span class="p">)</span> <span class="c1"># potential energy</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;v_t/2.0&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-atom-data">
<h2><a class="toc-backref" href="#id18">Accessing atom data</a></h2>
<p>All atoms in the current simulation can be accessed by using the L.atoms list.
Each element of this list is an object which exposes its properties (id, type,
position, velocity, force, etc.).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># access first atom</span>
<span class="n">L</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
<span class="n">L</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span>

<span class="c1"># access second atom</span>
<span class="n">L</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span>
<span class="n">L</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">velocity</span>
<span class="n">L</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">force</span>
</pre></div>
</div>
<p>Some properties can also be used to set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># set position in 2D simulation</span>
<span class="n">L</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># set position in 3D simulation</span>
<span class="n">L</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="evaluating-thermo-data">
<h2><a class="toc-backref" href="#id19">Evaluating thermo data</a></h2>
<p>Each simulation run usually produces thermo output based on system state,
computes, fixes or variables. The trajectories of these values can be queried
after a run via the L.runs list. This list contains a growing list of run data.
The first element is the output of the first run, the second element that of
the second run.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">L</span><span class="o">.</span><span class="n">runs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># data of first 1000 time steps</span>

<span class="n">L</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">L</span><span class="o">.</span><span class="n">runs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># data of second 1000 time steps</span>
</pre></div>
</div>
<p>Each run contains a dictionary of all trajectories. Each trajectory is
accessible through its thermo name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">L</span><span class="o">.</span><span class="n">runs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">step</span> <span class="c1"># list of time steps in first run</span>
<span class="n">L</span><span class="o">.</span><span class="n">runs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ke</span>   <span class="c1"># list of kinetic energy values in first run</span>
</pre></div>
</div>
<p>Together with matplotlib plotting data out of LAMMPS becomes simple:</p>
<p>import matplotlib.plot as plt</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">steps</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">runs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">step</span>
<span class="n">ke</span>    <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">runs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ke</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">ke</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="error-handling-with-pylammps">
<h2><a class="toc-backref" href="#id20">Error handling with PyLammps</a></h2>
<p>Compiling the shared library with C++ exception support provides a better error
handling experience.  Without exceptions the LAMMPS code will terminate the
current Python process with an error message.  C++ exceptions allow capturing
them on the C++ side and rethrowing them on the Python side. This way you
can handle LAMMPS errors through the Python exception handling mechanism.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Capturing a LAMMPS exception in Python can still mean that the
current LAMMPS process is in an illegal state and must be terminated. It is
advised to save your data and terminate the Python instance as quickly as
possible.</p>
</div>
</div>
<div class="section" id="using-pylammps-in-ipython-notebooks-and-jupyter">
<h2><a class="toc-backref" href="#id21">Using PyLammps in IPython notebooks and Jupyter</a></h2>
<p>If the LAMMPS Python package is installed for the same Python interpreter as
IPython, you can use PyLammps directly inside of an IPython notebook inside of
Jupyter. Jupyter is a powerful integrated development environment (IDE) for
many dynamic languages like Python, Julia and others, which operates inside of
any web browser. Besides auto-completion and syntax highlighting it allows you
to create formatted documents using Markup, mathematical formulas, graphics and
animations intermixed with executable Python code. It is a great format for
tutorials and showcasing your latest research.</p>
<p>To launch an instance of Jupyter simply run the following command inside your
Python environment (this assumes you followed the Quick Start instructions):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jupyter</span> <span class="n">notebook</span>
</pre></div>
</div>
</div>
<div class="section" id="ipylammps-examples">
<h2><a class="toc-backref" href="#id22">IPyLammps Examples</a></h2>
<p>Examples of IPython notebooks can be found in the python/examples/pylammps
subdirectory. To open these notebooks launch <em>jupyter notebook</em> inside this
directory and navigate to one of them. If you compiled and installed
a LAMMPS shared library with exceptions, PNG, JPEG and FFMPEG support
you should be able to rerun all of these notebooks.</p>
<div class="section" id="validating-a-dihedral-potential">
<h3><a class="toc-backref" href="#id23">Validating a dihedral potential</a></h3>
<p>This example showcases how an IPython Notebook can be used to compare a simple
LAMMPS simulation of a harmonic dihedral potential to its analytical solution.
Four atoms are placed in the simulation and the dihedral potential is applied on
them using a datafile. Then one of the atoms is rotated along the central axis by
setting its position from Python, which changes the dihedral angle.</p>
<pre class="literal-block">
phi = [d * math.pi / 180 for d in range(360)]

pos = [(1.0, math.cos(p), math.sin(p)) for p in phi]

pe = []
for p in pos:
    L.atoms[3].position = p
    L.run(0)
    pe.append(L.eval(&quot;pe&quot;))
</pre>
<p>By evaluating the potential energy for each position we can verify that
trajectory with the analytical formula.  To compare both solutions, we plot
both trajectories over each other using matplotlib, which embeds the generated
plot inside the IPython notebook.</p>
<img alt="_images/pylammps_dihedral.jpg" class="align-center" src="_images/pylammps_dihedral.jpg" />
</div>
<div class="section" id="running-a-monte-carlo-relaxation">
<h3><a class="toc-backref" href="#id24">Running a Monte Carlo relaxation</a></h3>
<p>This second example shows how to use PyLammps to create a 2D Monte Carlo Relaxation
simulation, computing and plotting energy terms and even embedding video output.</p>
<p>Initially, a 2D system is created in a state with minimal energy.</p>
<img alt="_images/pylammps_mc_minimum.jpg" class="align-center" src="_images/pylammps_mc_minimum.jpg" />
<p>It is then disordered by moving each atom by a random delta.</p>
<pre class="literal-block">
random.seed(27848)
deltaperturb = 0.2

for i in range(L.system.natoms):
    x, y = L.atoms[i].position
    dx = deltaperturb * random.uniform(-1, 1)
    dy = deltaperturb * random.uniform(-1, 1)
    L.atoms[i].position  = (x+dx, y+dy)

L.run(0)
</pre>
<img alt="_images/pylammps_mc_disordered.jpg" class="align-center" src="_images/pylammps_mc_disordered.jpg" />
<p>Finally, the Monte Carlo algorithm is implemented in Python. It continuously
moves random atoms by a random delta and only accepts certain moves.</p>
<pre class="literal-block">
estart = L.eval(&quot;pe&quot;)
elast = estart

naccept = 0
energies = [estart]

niterations = 3000
deltamove = 0.1
kT = 0.05

natoms = L.system.natoms

for i in range(niterations):
    iatom = random.randrange(0, natoms)
    current_atom = L.atoms[iatom]

    x0, y0 = current_atom.position

    dx = deltamove * random.uniform(-1, 1)
    dy = deltamove * random.uniform(-1, 1)

    current_atom.position = (x0+dx, y0+dy)

    L.run(1, &quot;pre no post no&quot;)

    e = L.eval(&quot;pe&quot;)
    energies.append(e)

    if e &lt;= elast:
        naccept += 1
        elast = e
    elif random.random() &lt;= math.exp(natoms*(elast-e)/kT):
        naccept += 1
        elast = e
    else:
        current_atom.position = (x0, y0)
</pre>
<p>The energies of each iteration are collected in a Python list and finally plotted using matplotlib.</p>
<img alt="_images/pylammps_mc_energies_plot.jpg" class="align-center" src="_images/pylammps_mc_energies_plot.jpg" />
<p>The IPython notebook also shows how to use dump commands and embed video files
inside of the IPython notebook.</p>
</div>
</div>
<div class="section" id="using-pylammps-and-mpi4py-experimental">
<h2><a class="toc-backref" href="#id25">Using PyLammps and mpi4py (Experimental)</a></h2>
<p>PyLammps can be run in parallel using mpi4py. This python package can be installed using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">mpi4py</span>
</pre></div>
</div>
<p>The following is a short example which reads in an existing LAMMPS input file and
executes it in parallel.  You can find in.melt in the examples/melt folder.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpi4py</span> <span class="k">import</span> <span class="n">MPI</span>
<span class="kn">from</span> <span class="nn">lammps</span> <span class="k">import</span> <span class="n">PyLammps</span>

<span class="n">L</span> <span class="o">=</span> <span class="n">PyLammps</span><span class="p">()</span>
<span class="n">L</span><span class="o">.</span><span class="n">file</span><span class="p">(</span><span class="s2">&quot;in.melt&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Potential energy: &quot;</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s2">&quot;pe&quot;</span><span class="p">))</span>

<span class="n">MPI</span><span class="o">.</span><span class="n">Finalize</span><span class="p">()</span>
</pre></div>
</div>
<p>To run this script (melt.py) in parallel using 4 MPI processes we invoke the
following mpirun command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="mi">4</span> <span class="n">python</span> <span class="n">melt</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Any command must be executed by all MPI processes. However, evaluations and querying the system state is only available on rank 0.</p>
</div>
</div>
<div class="section" id="feedback-and-contributing">
<h2><a class="toc-backref" href="#id26">Feedback and Contributing</a></h2>
<p>If you find this Python interface useful, please feel free to provide feedback
and ideas on how to improve it to Richard Berger (<a class="reference external" href="mailto:richard&#46;berger&#37;&#52;&#48;temple&#46;edu">richard<span>&#46;</span>berger<span>&#64;</span>temple<span>&#46;</span>edu</a>). We also
want to encourage people to write tutorial style IPython notebooks showcasing LAMMPS usage
and maybe their latest research results.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial_bash_on_windows.html" class="btn btn-neutral float-right" title="Using LAMMPS with Bash on Windows" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial_github.html" class="btn btn-neutral" title="LAMMPS GitHub tutorial" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013 Sandia Corporation.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>